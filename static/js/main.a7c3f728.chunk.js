(this["webpackJsonpcamaew-up"]=this["webpackJsonpcamaew-up"]||[]).push([[0],{127:function(e,a){},131:function(e,a,t){"use strict";t.r(a);var n=t(0),l=t.n(n),r=t(23),o=t.n(r),c=(t(91),t(9)),i=t(81),m=t(43),s=t(56);function u(e,a){for(var t=new Array(e),n=0;n<e;n++)t[n]=Object(s.cloneDeep)(a);return t}function d(e){var a=Array.from(new Array(e.numCats),(function(e,a){return a}));return a.sort((function(a,t){if(e.pos[a]!==e.pos[t])return e.pos[t]-e.pos[a];var n=e.board[e.pos[a]].stack;return n.indexOf(t)-n.indexOf(a)})),a}function p(e,a){e.dice=Array(e.numCats).fill(0);for(var t=0;t<a.numPlayers;t++)e.players[t].smallBets=Array(e.numCats).fill([]),g(e,t);e.smallStack=Array(e.numCats).fill([2,3,5])}function f(e,a){console.log("End of small round."),e.dice=Array(e.numCats).fill(0);for(var t=d(e),n=0;n<a.numPlayers;n++){var l=0;l+=Object(s.sum)(e.players[n].smallBets[t[0]]),l+=e.players[n].smallBets[t[1]].length;for(var r=2;r<e.numCats;r++)l-=e.players[n].smallBets[t[r]].length;console.log("Small bet wins for",n,l),e.players[n].coins+=l}}function v(e,a,t){var n=e.dice.filter((function(e){return 0===e})).length,l=a.random.Die(n)-1,r=a.random.Die(3),o=0,c=0;for(c=0;c<e.numCats;c++)if(0===e.dice[c]){if(o===l){e.dice[c]=r,e.lastDiceRolled=c;break}o++}c===e.numCats&&console.error("Something's wrong. The dice probably didn't get reset."),console.log("Roll dice",c,"->",r),function(e,a,t,n){var l=e.pos[t],r=[];if(l>=0){var o=e.board[l].stack,c=o.indexOf(t);r=o.slice(c),console.log("curStack",r),e.board[l].stack=e.board[l].stack.slice(0,c)}else r=[t];e.board[l+n].stack=e.board[l+n].stack.concat(r);for(var i=0;i<r.length;i++)e.pos[r[i]]+=n;e.cleanUp=l+n}(e,0,c,r),null!=t&&(e.players[t].coins+=1)}function y(e,a,t,n){e.board[t].mod={playerID:a,type:n},e.players[a].modPos=t}function g(e,a){e.players[a].modPos>-1&&(e.board[e.players[a].modPos].mod=null,e.players[a].modPos=-1)}var E={name:"CamaewUp",setup:function(e,a){for(var t={numCats:a.numCats,numTiles:a.numTiles,dice:Array(a.numCats).fill(0),lastDiceRolled:-1,cleanUp:-1,pos:Array(a.numCats).fill(-1),board:u(a.numTiles+3,{stack:[],mod:null}),players:u(e.numPlayers,{coins:0,smallBets:Array(a.numCats).fill([]),betCards:Array(a.numCats).fill(!0),modPos:-1}),smallStack:Array(a.numCats).fill([2,3,5]),bigStack:{win:[],lose:[]}},n=0;n<t.numCats;n++)v(t,e);return p(t,e),t},moves:{roll:function(e,a,t){v(e,a,t),function(e,a){var t=e.board[e.cleanUp].mod;if(null!==t){e.players[t.playerID].coins+=1;var n=e.board[e.cleanUp].stack;if(e.board[e.cleanUp].stack=[],"tape"===t.type){e.board[e.cleanUp-1].stack=n.concat(e.board[e.cleanUp-1].stack);for(var l=0;l<n.length;l++)e.pos[n[l]]=e.cleanUp-1;console.log("Got taped")}else if("cucumber"===t.type){e.board[e.cleanUp+1].stack=e.board[e.cleanUp+1].stack.concat(n);for(var r=0;r<n.length;r++)e.pos[n[r]]=e.cleanUp+1;console.log("Got cucumbered")}}}(e),e.cleanUp>=e.numTiles&&(f(e,a),function(e,a){console.log("End of race.");for(var t=d(e),n=[1,2,3,5,8],l=0;l<e.bigStack.win.length;l++){var r=e.bigStack.win[l];r.bet===t[0]?e.players[r.playerID].coins+=n.pop():e.players[r.playerID].coins-=1,0===n.length&&(n=[1])}for(var o=[1,2,3,5,8],c=0;c<e.bigStack.lose.length;c++){var i=e.bigStack.lose[c];i.bet===t[e.numCats-1]?e.players[i.playerID].coins+=o.pop():e.players[i.playerID].coins-=1,0===o.length&&(o=[1])}}(e)),0===e.dice.filter((function(e){return 0===e})).length&&(f(e,a),p(e,a))},makeSmallBet:function(e,a,t,n){!function(e,a,t){e.players[a].smallBets[t].push(e.smallStack[t].pop())}(e,t,n)},makeBigBet:function(e,a,t,n,l){!function(e,a,t,n){e.bigStack[n].push({playerID:a,bet:t}),e.players[a].betCards[t]=!1}(e,t,n,l)},placeMod:function(e,a,t,n,l){y(e,t,n,l)},removeMod:function(e,a,t){g(e,t)},flipMod:function(e,a,t){var n="tape"===e.board[e.players[t].modPos].mod.type?"cucumber":"tape",l=e.players[t].modPos;g(e,t),y(e,t,l,n)},moveMod:function(e,a,t,n,l){g(e,t),y(e,t,n,l)}},turn:{moveLimit:1,onEnd:function(e,a){},onMove:function(e,a){}},minPlayers:2,maxPlayers:8},b=t(83);var k=function(e){e.data;var a=e.onJoinClick,t=e.onCreateClick;return l.a.createElement("div",{id:"entry-container",className:"lobby"},l.a.createElement("div",null,l.a.createElement(b.a,{variant:"primary",onClick:a,size:"lg"},"Join Game")),l.a.createElement("div",null,l.a.createElement(b.a,{variant:"primary",onClick:t,size:"lg"},"Create Game")))},C=t(136);var h=function(e){var a=e.data,t=e.onJoinJoinClick;return l.a.createElement("div",{className:"lobby"},l.a.createElement("div",null,l.a.createElement(C.a.Label,null,"Name"),l.a.createElement(C.a.Control,{type:"text",value:a.name,onChange:a.onNameChange})),l.a.createElement("div",{id:"join-gameid"},l.a.createElement(C.a.Label,null,"Game ID"),l.a.createElement(C.a.Control,{type:"text",value:a.gameID,onChange:a.onGameIDChange})),l.a.createElement("div",{id:"lobby-join",className:"center"},l.a.createElement(C.a.Label,null,"Join Game"),l.a.createElement(b.a,{variant:"primary",onClick:t,disabled:!a.gameID||!a.name},"Join"),l.a.createElement(b.a,{variant:"secondary",onClick:a.backToEntry},"Back")))},D=t(138),I=t(74);var N=function(e){var a=e.data,t=e.onCreateCreateClick;return l.a.createElement("div",{className:"lobby"},l.a.createElement("div",null,l.a.createElement(C.a.Label,null,"Name"),l.a.createElement(C.a.Control,{type:"text",value:a.name,onChange:a.onNameChange})),l.a.createElement("div",null,l.a.createElement(C.a.Label,null,"Number of players"),l.a.createElement(D.a,{type:"radio",name:"numPlayers",value:a.numPlayers,onChange:a.onNumPlayersChange},l.a.createElement(I.a,{value:2},"2"),l.a.createElement(I.a,{value:3},"3"),l.a.createElement(I.a,{value:4},"4"),l.a.createElement(I.a,{value:5},"5"),l.a.createElement(I.a,{value:6},"6"),l.a.createElement(I.a,{value:7},"7"),l.a.createElement(I.a,{value:8},"8"))),l.a.createElement("div",null,l.a.createElement(C.a.Label,null,"Number of cats"),l.a.createElement(D.a,{type:"radio",name:"numCats",value:a.numCats,onChange:a.onNumCatsChange},l.a.createElement(I.a,{value:3},"3"),l.a.createElement(I.a,{value:4},"4"),l.a.createElement(I.a,{value:5},"5"),l.a.createElement(I.a,{value:6},"6"))),l.a.createElement("div",null,l.a.createElement(C.a.Check,{type:"checkbox",label:"Veil mode"}),l.a.createElement(C.a.Check,{type:"checkbox",label:"Random seat"})),l.a.createElement("div",null,l.a.createElement(b.a,{variant:"primary",onClick:t,disabled:!a.name},"Create"),l.a.createElement(b.a,{variant:"secondary",onClick:a.backToEntry},"Back")))},S=t(135);var M=function(e){var a,t,n,r=e.data,o=e.serverPath,i=e.startGame,m=l.a.useState(null),s=Object(c.a)(m,2),u=s[0],d=s[1],p=l.a.useState(0),f=Object(c.a)(p,2),v=f[0],y=f[1],g=l.a.useState(-1),E=Object(c.a)(g,2),k=E[0],C=E[1],h=l.a.useState(""),D=Object(c.a)(h,2),I=D[0],N=D[1],M=l.a.useState(!1),j=Object(c.a)(M,2),P=j[0],B=j[1],O=l.a.useCallback((function(){console.log("Getting game info...",r.gameID),fetch(o+"/"+r.gameID,{method:"get"}).then((function(e){return e.json()})).then((function(e){return d(e)}))}),[r.gameID,o]),T=l.a.useCallback((function(){O();for(var e=0;e<u.players.length;e++)if(null==u.players[e].name)return e}),[u,O]),w=l.a.useCallback((function(){console.log("Sitting...",u);var e=T();console.log("Found empty seat",e);var a={playerID:e,playerName:r.name};fetch(o+"/"+u.roomID+"/join",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((function(e){return e.json()})).then((function(a){N(a.playerCredentials),C(e),O()}))}),[r.name,T,u,o,O]);function x(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a={playerID:k,credentials:I};fetch(o+"/"+u.roomID+"/leave",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((function(){e&&O()})),C(-1)}return l.a.useEffect((function(){var e=setInterval((function(){O()}),2e3);return function(){clearInterval(e)}})),l.a.useEffect((function(){null!=u&&y((function(){for(var e=0,a=0;a<u.players.length;a++)null!=u.players[a].name&&e++;return e}))}),[u,I,k,w]),null==u?(O(),l.a.createElement("div",null,"Connecting... ",o)):l.a.createElement("div",{className:"lobby"},l.a.createElement("div",null,"gameID: ",u.roomID),l.a.createElement("div",null,u.players.map((function(e,a){return l.a.createElement("div",{key:a},e.id," - ",e.name)}))),l.a.createElement("div",null,l.a.createElement(b.a,{variant:"secondary",onClick:w,disabled:k>=0},"Sit"),l.a.createElement(b.a,{variant:"secondary",onClick:x,disabled:k<0||1===v},"Stand"),l.a.createElement(b.a,{variant:"secondary",onClick:function(){console.log("Leaving..."),B(!0)}},"Leave"),l.a.createElement(b.a,{variant:"primary",onClick:function(){return i(r.gameID,k,I)},disabled:v<u.players.length},"Start")),(t=P,n=B,void 0===(a={header:"Leaving",body:"Are you sure you'd like to leave?",confirm:"Leave"}).confirm&&(a.confirm="Confirm"),l.a.createElement(S.a,{show:t,onHide:function(){return n(!1)}},a.header&&l.a.createElement(S.a.Header,{closeButton:!0},l.a.createElement(S.a.Title,null,a.header)),l.a.createElement(S.a.Body,null,a.body),l.a.createElement(S.a.Footer,null,l.a.createElement(b.a,{variant:"secondary",onClick:function(){return n(!1)}},"Close"),l.a.createElement(b.a,{variant:"primary",onClick:function(){x(!1),r.backToEntry(),n(!1)}},a.confirm)))))};var j=function(e){var a=e.serverPath,t=e.startGame,n=l.a.useState(""),r=Object(c.a)(n,2),o=r[0],i=r[1],m=l.a.useState("entry"),s=Object(c.a)(m,2),u=s[0],d=s[1],p=l.a.useState(""),f=Object(c.a)(p,2),v=f[0],y=f[1],g=l.a.useState(4),E=Object(c.a)(g,2),b=E[0],C=E[1],D=l.a.useState(5),I=Object(c.a)(D,2),S=I[0],j=I[1];function P(){d("wait")}var B={name:o,gameID:v,numPlayers:b,numCats:S,onNameChange:function(e){i(e.target.value)},onGameIDChange:function(e){y(e.target.value)},onNumPlayersChange:function(e){C(e)},onNumCatsChange:function(e){j(e)},backToEntry:function(){d("entry")}};return"entry"===u?l.a.createElement(k,{data:B,onJoinClick:function(){d("join")},onCreateClick:function(){d("create")}}):"join"===u?l.a.createElement(h,{data:B,onJoinJoinClick:function(){console.log("Joining a game...",v),P()}}):"create"===u?l.a.createElement(N,{data:B,onCreateCreateClick:function(){console.log("Creating game..."),(console.log("Creating game..."),fetch(a+"/create",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({numPlayers:b,setupData:{numCats:S,numTiles:16}})}).then((function(e){return e.json()}))).then((function(e){console.log("Game created",e.gameID),y(e.gameID),P()}))}}):"wait"===u?(console.log("name",o),l.a.createElement(M,{data:B,serverPath:a,startGame:t})):void 0};function P(e){var a=e.className,t=e.cellData,n=e.cell_id,r=e.playerID,o=e.gameMetadata,c=e.prePlaceMod,i=(e.preMoveMod,e.preFlipMod);return l.a.createElement("div",{className:"cell "+a,onDragOver:function(e){e.preventDefault()},onDrop:function(e){e.preventDefault(),c(Number(n),e.dataTransfer.getData("type"))}},l.a.createElement("div",{className:"cell-content"},t.stack.slice(0).reverse().map((function(e,a){return l.a.createElement("div",{className:"token tokencolor-".concat(e+1),key:"cat_stack"+a},e,l.a.createElement("br",null))}))),t.mod&&l.a.createElement("div",{className:"cell-mod card ".concat(t.mod.type),onClick:function(){i(Number(n))},draggable:r===t.mod.playerID,onDragStart:function(e){e.dataTransfer.setData("type","move")}},o[t.mod.playerID].name))}function B(e){var a=e.G,t=e.playerID,n=e.gameMetadata,r=e.placeMod,o=e.moveMod,i=e.removeMod,m=e.flipMod,s=l.a.useState(!1),u=Object(c.a)(s,2),d=u[0],p=u[1],f=l.a.useState(!1),v=Object(c.a)(f,2),y=v[0],g=v[1],E=l.a.useState(null),k=Object(c.a)(E,2),C=k[0],h=k[1],D=l.a.useState(null),I=Object(c.a)(D,2),N=I[0],M=I[1];function j(e,n){if("place"===n&&a.players[t].modPos>-1)console.error("Player has already placed his/her mod.");else if(a.board[e].stack.length>0)console.error("Cannot place mod where cats are.");else if(e>0&&null!==a.board[e-1].mod&&a.board[e-1].mod.playerID!==t||e<a.board.length-1&&null!==a.board[e+1].mod&&a.board[e+1].mod!==t)console.error("Cannot place mod adjacent to an existing mod.");else if(null===a.board[e].mod)h(e),M(n),p(!0);else{if(a.board[e].mod.playerID===t)return;console.error("Cannot place mod on top of an existing mod.")}}function B(e){h(e),g(!0)}function O(){return l.a.createElement(S.a,{show:d,onHide:function(){return p(!1)}},l.a.createElement(S.a.Header,{closeButton:!0},l.a.createElement(S.a.Title,null,"Placing Mod")),l.a.createElement(S.a.Body,null,"Which kind of mod would you like to place?"),l.a.createElement(S.a.Footer,null,l.a.createElement(b.a,{variant:"secondary",onClick:function(){return p(!1)}},"Cancel"),l.a.createElement(b.a,{variant:"danger",onClick:function(){console.log("Place tape mod"),"place"===N?r(t,C,"tape"):"move"===N&&o(t,C,"tape"),p(!1)}},"Tape"),l.a.createElement(b.a,{variant:"success",onClick:function(){console.log("Place cucumber mod"),"place"===N?r(t,C,"cucumber"):"move"===N&&o(t,C,"cucumber"),p(!1)}},"Cucumber")))}function T(){return l.a.createElement(S.a,{show:y,onHide:function(){return g(!1)}},l.a.createElement(S.a.Header,{closeButton:!0},l.a.createElement(S.a.Title,null,"Flipping Mod")),l.a.createElement(S.a.Body,null,"Would you like to flip the mod?"),l.a.createElement(S.a.Footer,null,l.a.createElement(b.a,{variant:"secondary",onClick:function(){return g(!1)}},"Cancel"),l.a.createElement(b.a,{variant:"outline-primary",onClick:function(){console.log("Remove mod"),i(t),g(!1)}},"Remove"),l.a.createElement(b.a,{variant:"primary",onClick:function(){console.log("Flip mod"),m(t),g(!1)}},"Flip")))}return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"board"},a.board.slice(0,a.numTiles).map((function(e,a){return l.a.createElement(P,{cellData:e,key:a,cell_id:a,playerID:t,gameMetadata:n,prePlaceMod:j,preFlipMod:B})})),a.board.slice(a.numTiles).map((function(e,a){return l.a.createElement(P,{className:"cell-extra",cellData:e,key:a,cell_id:a,playerID:t,gameMetadata:n,prePlaceMod:j,preFlipMod:B})}))),l.a.createElement(O,null),l.a.createElement(T,null))}var O=t(137);var T=function(e){var a=e.currentPlayer,t=e.players,n=e.gameMetadata;return l.a.createElement("div",{className:"players"},l.a.createElement(O.a,null,n.map((function(e,n){return l.a.createElement(O.a.Item,{active:e.id===Number(a),className:"flex",key:"player"+n},"".concat(e.name," (").concat(t[n].coins,")"),t[n].smallBets.map((function(e,a){return l.a.createElement(l.a.Fragment,{key:"smallBets"+a},e.map((function(e){return l.a.createElement("div",{className:"tokencolor-".concat(a+1," card"),key:"smallBet"+n},e)})))})))}))))};function w(e){var a=e.dice;return l.a.createElement("div",null,l.a.createElement("div",{className:"section"},"Rolled dice"),l.a.createElement(O.a,{horizontal:!0},a.map((function(e,a){return l.a.createElement(O.a.Item,{className:"tokencolor-".concat(a+1),key:a},e)}))))}var x=function(e){var a=e.stack,t=e.makeSmallBet;return l.a.createElement("div",null,l.a.createElement("div",{className:"section"},"SmallStack"),l.a.createElement(O.a,{horizontal:!0},a.map((function(e,a){return l.a.createElement(O.a.Item,{className:"tokencolor-".concat(a+1),onClick:function(){return t(a)},key:a},e[e.length-1])}))))};function G(e){var a=e.cards;function t(e){e.dataTransfer.setData("betID",e.target.getAttribute("bet_id"))}return l.a.createElement("div",null,l.a.createElement("div",{className:"section"},"Bet Cards"),l.a.createElement("div",{className:"flex"},a.map((function(e,a){return e?l.a.createElement("div",{className:"tokencolor-".concat(a+1," card"),bet_id:a,draggable:"true",onDragStart:t,key:"betCards"+a},"X"):null}))))}function A(e){var a=e.stack,t=e.playerID,n=e.makeBigBet,r=e.side;return l.a.createElement("div",{className:"betzone",onDragOver:function(e){e.preventDefault()},onDrop:function(e){e.preventDefault(),console.log("dropped",e.dataTransfer.getData("betID")),n(t,Number(e.dataTransfer.getData("betID")),r)}},"".concat(r,": ").concat(a[r].length))}function J(e){var a=e.hasMod,t=e.playerID;return l.a.createElement("div",null,l.a.createElement("div",{className:"section"},"Mod Tile"),l.a.createElement("div",{className:"flex"},l.a.createElement("div",{className:"card",draggable:a,player_id:t,onDragStart:function(e){e.dataTransfer.setData("playerID",e.target.getAttribute("player_id")),e.dataTransfer.setData("type","place")}},a?"X":"\u2013")))}var U=function(e){var a=e.G,t=e.ctx,n=e.moves,r=e.playerID,o=e.gameMetadata;function c(e,a,t){console.log("bigbet...",e,a,t),n.makeBigBet(e,a,t)}return r=Number(r),l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"flex"},l.a.createElement("div",{className:"control"},l.a.createElement("div",{className:"section"},"Camaew Up!"),l.a.createElement("div",null,l.a.createElement(T,{currentPlayer:t.currentPlayer,players:a.players,gameMetadata:o})),l.a.createElement("div",null,l.a.createElement(b.a,{variant:"primary",onClick:function(){n.roll(r)}},"Roll"),l.a.createElement(w,{dice:a.dice}))),l.a.createElement("div",{className:"control"},l.a.createElement(J,{hasMod:-1===a.players[r].modPos,playerID:r}),l.a.createElement(x,{stack:a.smallStack,makeSmallBet:function(e){a.smallStack[e].length>0&&n.makeSmallBet(r,e)}}),l.a.createElement(G,{cards:a.players[r].betCards}),l.a.createElement("div",{className:"flex"},l.a.createElement(A,{stack:a.bigStack,playerID:r,makeBigBet:c,side:"win"}),l.a.createElement(A,{stack:a.bigStack,playerID:r,makeBigBet:c,side:"lose"})))),l.a.createElement(B,{G:a,playerID:r,gameMetadata:o,placeMod:function(e,a,t){console.log("Trying to place mod:",e,a,t),n.placeMod(e,a,t)},moveMod:function(e,a,t){console.log("Move mod"),n.moveMod(e,a,t)},removeMod:function(e){console.log("Remove mod"),n.removeMod(e)},flipMod:function(e,a){console.log("Flip mod"),n.flipMod(e,a)}}))},F=t(82),L=(t(96),"http://c91fdc5aa037.ngrok.io"),R=Object(i.a)({game:E,board:U,multiplayer:Object(m.b)({server:L}),debug:!1}),_=Object(F.a)();var H=function(){var e=Object(n.useState)("lobby"),a=Object(c.a)(e,2),t=a[0],r=a[1],o=Object(n.useState)({}),i=Object(c.a)(o,2),m=i[0],s=i[1];return Object(n.useEffect)((function(){"game"===t.name&&_.push("?"+t.gameID)}),[t.name,t.gameID]),"lobby"===t?l.a.createElement("div",null,l.a.createElement(j,{serverPath:"http://c91fdc5aa037.ngrok.io/games/CamaewUp",startGame:function(e,a,t){s({gameID:e,playerID:a,credentials:t}),r("game")}})):"game"===t?l.a.createElement("div",null,l.a.createElement(R,{gameID:m.gameID,playerID:String(m.playerID),credentials:m.credentials})):void 0};o.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(H,null)),document.getElementById("root"))},86:function(e,a,t){e.exports=t(131)},91:function(e,a,t){},96:function(e,a,t){}},[[86,1,2]]]);
//# sourceMappingURL=main.a7c3f728.chunk.js.map